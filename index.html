<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cattery Quick Review</title>
  <link rel="stylesheet" href="css/styles.css">
  <style>
    .rating { display: flex; justify-content: center; gap: 5px; font-size: 2rem; cursor: pointer; }
    .star.selected { color: gold; }
    .option { padding: 5px 10px; margin: 5px; border-radius: 5px; border: 1px solid #333; cursor: pointer; }
    .option.selected { background-color: #333; color: #fff; }
    #options { display: flex; justify-content: center; flex-wrap: wrap; }
    #review-text { width: 100%; min-height: 120px; margin-top: 10px; }
    .submit-button { display: block; margin: 10px auto; padding: 10px 20px; cursor: pointer; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Cat Heaven Hotel Review</h1>
    <p class="intro">
      Thanks for leaving and entrusting your pet with us! We would love to receive your review üíú
    </p>

    <div class="step">
      <h2>Step 1: Select the Stars for us</h2>
      <div class="rating">
        <span class="star" data-value="1">‚≠ê</span>
        <span class="star" data-value="2">‚≠ê</span>
        <span class="star" data-value="3">‚≠ê</span>
        <span class="star" data-value="4">‚≠ê</span>
        <span class="star" data-value="5">‚≠ê</span>
      </div>
    </div>

    <div class="step">
      <h2>Step 2: Select Services to Mention</h2>
      <div id="options">
        <button class="option">Service</button>
        <button class="option">Staff</button>
        <button class="option">Rooms</button>
        <button class="option">Prices</button>
      </div>
    </div>

    <div class="step">
      <h2>Step 3: Generated Review</h2>
      <textarea id="review-text" placeholder="Your review will appear here..."></textarea>
    </div>

    <button class="submit-button" onclick="postReview()">Post Review to Google</button>
  </div>

  <script>
    const stars = document.querySelectorAll('.star');
    let currentRating = 0;
    let selectedServices = [];
    const options = document.querySelectorAll('.option');
    const reviewTextArea = document.getElementById('review-text');
    let userTyping = false;

    // Stars click
    stars.forEach(star => {
      star.addEventListener('click', () => {
        currentRating = parseInt(star.dataset.value);
        updateStars();
        generateAIReview();
      });
    });

    function updateStars() {
      stars.forEach(star => {
        star.classList.toggle('selected', parseInt(star.dataset.value) <= currentRating);
      });
    }

    // Services click
    options.forEach(option => {
      option.addEventListener('click', () => {
        option.classList.toggle('selected');
        const service = option.textContent;
        if (selectedServices.includes(service)) {
          selectedServices = selectedServices.filter(s => s !== service);
        } else {
          selectedServices.push(service);
        }
        generateAIReview();
      });
    });

    // Stop AI overwriting when user types
    reviewTextArea.addEventListener('input', () => {
      userTyping = true;
    });

    function generateAIReview() {
      if (currentRating === 0 || selectedServices.length === 0 || userTyping) return;

      reviewTextArea.value = "Generating AI review...";

      fetch('http://localhost:3000/generate-review', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ rating: currentRating, services: selectedServices })
      })
      .then(res => res.json())
      .then(data => {
        if (!userTyping) {
          reviewTextArea.value = data.text || "Error generating review.";
        }
      })
      .catch(err => {
        console.error(err);
        if (!userTyping) reviewTextArea.value = "Error generating review.";
      });
    }

    // Open Google review link
    function postReview() {
      const googleReviewLink = 'https://g.page/r/CATTERY_GOOGLE_REVIEW_LINK';
      window.open(googleReviewLink, '_blank');
    }
  </script>
</body>
</html>
